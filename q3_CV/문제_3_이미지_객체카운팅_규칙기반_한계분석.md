## 문제 3: 이미지 기반 객체 카운팅(규칙 기반 구현 및 한계 분석)

### [ 시험 정보 ]
| 항목 | 내용 |
|------|------|
| 과정 | AI 올인원 |
| 단계 | AI/SW 심화 |
| 난이도 | 2 |
| 권장 시간 | 25분 |
| 관련 과목 | 컴퓨터 비전, AI 수학, 딥러닝, 머신러닝 |
| Pass 기준 | 정답 체크리스트 7개 중 7개 모두 충족 |

---

### [ 문제 ]

당신은 물류 창고의 재고 관리 시스템을 구축하는 비전 엔지니어입니다.
컨베이어 벨트 위를 지나가는 **박스(Box)의 개수**를 자동으로 세는 시스템을 만들어야 합니다.

제공되는 이미지 셋은 3개 카테고리로 구분됩니다:

| 카테고리 | 장수 | 특징 |
|----------|------|------|
| `easy` | 5장 | 밝은 배경, 박스 간 간격 충분, 균일한 간격 |
| `medium` | 5장 | 박스 일부 겹침, 약간의 그림자 존재 |
| `hard` | 5장 | 적재(Stacked) 형태 포함, 불규칙한 다각형 형태의 박스 존재, 크기 편차가 매우 큰, 여러 객체 간의 밀집 및 시각적 겹침 |

각 이미지의 정답 박스 개수는 `labels.json`에 제공됩니다.

다음 요구사항을 모두 충족하는 Python 스크립트 `q3_solution.py`를 작성하십시오.

---

### [ 요구사항 ]

#### Part A: 컨볼루션 기반 엣지 검출 (직접 구현)

1. **NumPy만으로 2D 컨볼루션 함수 `conv2d(image, kernel)`를 구현하세요.**
   - 입력: 2D 배열(이미지)과 2D 배열(커널)
   - 출력: **valid 모드**의 컨볼루션 결과

2. **Sobel 커널(3×3)**을 정의하여 수평/수직 엣지를 각각 검출하고, 엣지 크기를 계산하세요:
   ```
   edge_magnitude = sqrt(Gx² + Gy²)
   ```

#### Part B: 박스 카운팅 파이프라인

3. 엣지 이미지를 **이진화(thresholding)** 하세요.

4. **Connected Component 분석**으로 박스 개수를 추정하세요.
   - 직접 구현(BFS/DFS)하거나 `scipy.ndimage.label`을 사용할 수 있습니다.

5. **최소 면적 필터**: 너무 작은 컴포넌트(노이즈)를 제거하기 위해 `min_area` 기준을 적용하세요.

#### Part C: 정량적 성능 분석 및 한계 보고

6. **각 카테고리(easy/medium/hard)별로 다음 지표를 계산하세요:**
   - **MAE** (Mean Absolute Error): 예측 개수와 실제 개수 차이의 평균
   - **Accuracy**: 정확히 맞춘 이미지 수 / 전체 이미지 수

7. **hard 카테고리**에서 가장 큰 오차가 발생한 이미지에 대해, 규칙 기반 방식이 **왜 실패했는지 기술적 원인을 3가지 이상** 서술하세요.

8. 이 경험을 바탕으로, **왜 학습 기반 접근법(CNN 등)이 필요한지 200자 이내**로 서술하세요.

---

### [ 제약 사항 ]
- `conv2d` 함수는 반드시 **NumPy만으로 직접 구현** (`cv2.filter2D` 등 사용 금지)
- 이미지 로드에는 `PIL` 또는 `cv2` 사용 가능
- 그레이스케일 변환 공식: `gray = 0.299*R + 0.587*G + 0.114*B` (직접 구현)
- `threshold` 값과 `min_area` 값은 코드 내에서 **명시적으로 변수**로 정의할 것

---

### [ 입력 형식 ]

| 파일/폴더 | 설명 |
|-----------|------|
| `images/` | `easy_01.png` ~ `easy_05.png`, `medium_01.png` ~ `medium_05.png`, `hard_01.png` ~ `hard_05.png` (640×480 RGB) |
| `labels.json` | `{"easy_01": 3, "easy_02": 5, ...}` 형태 |

---

### [ 출력 형식 ]

`result_q3.json` 파일로 다음 구조를 저장하세요:

```json
{
  "predictions": {"easy_01": 정수, "easy_02": 정수, ...},
  "metrics": {
    "easy":   {"mae": 실수, "accuracy": 실수},
    "medium": {"mae": 실수, "accuracy": 실수},
    "hard":   {"mae": 실수, "accuracy": 실수}
  },
  "worst_case_image": "",
  "failure_reasons": ["이유1 (20자 이상)", "이유2", "이유3"],
  "why_learning_based": "200자 이내 서술"
}
```

---

### [ 제출 방식 ]

아래 **두 파일**을 `submissions/` 폴더에 제출하세요.

| 파일 | 파일명 형식 | 예시 |
|------|------------|------|
| 솔루션 코드 | `solution_{단계}_q3_{학번}.py` | `solution_advanced_q3_20210001.py` |
| 결과 JSON | `result_{단계}_q3_{학번}.json` | `result_advanced_q3_20210001.json` |

- **단계**: `advanced` (심화) / `basic` (기초) / `intro` (입학연수)
- **학번**: 본인 학번
- 두 파일 모두 제출해야 채점이 진행됩니다.
