## 문제 4: 고객 리뷰 감성 분석 — 규칙 기반 + ML 파이프라인 + SHAP 해석

### [ 시험 정보 ]
| 항목 | 내용 |
|------|------|
| 과정 | AI 올인원 |
| 단계 | AI/SW 심화 |
| 난이도 | 2 |
| 권장 시간 | 25분 |
| 관련 과목 | 자연어 처리, 머신러닝, 데이터 분석, 딥러닝 |
| Pass 기준 | 정답 체크리스트 8개 중 8개 모두 충족 |

---

### [ 문제 ]

당신은 이커머스 플랫폼의 데이터 분석가입니다.
고객 리뷰 데이터(`reviews.csv`)에 대해 감성 분석 시스템을 **두 가지 방식**으로 구축하고, 그 성능을 비교 분석해야 합니다.

> **⚠ 주의:** `reviews.csv`의 label 분포는 **긍정(1): 900건, 부정(0): 100건**으로 **불균형 상태**입니다.

다음 요구사항을 모두 충족하는 Python 스크립트 `q4_solution.py`를 작성하십시오.

---

### [ 요구사항 ]

#### Part A: 규칙 기반 감성 분석

1. **감성 사전**(`sentiment_dict.json`)을 로드하세요. 구조는 다음과 같습니다:
   ```json
   {
     "positive": {"좋다": 1.0, "훌륭하다": 1.5, ...},
     "negative": {"나쁘다": -1.0, "불만": -1.5, ...},
     "negation": ["안", "않", "못", "없"],
     "intensifier": {"매우": 1.5, "정말": 1.3, "너무": 1.2, ...}
   }
   ```

2. **규칙 기반 감성 점수 산출 로직:**
   - (a) 텍스트를 공백 기준으로 토큰화
   - (b) 각 토큰의 감성 점수를 사전에서 조회
   - (c) **부정어 처리**: 부정어 바로 다음 토큰의 감성 점수에 **-1을 곱함**
   - (d) **강조어 처리**: 강조어 바로 다음 토큰의 감성 점수에 해당 **배수를 곱함**
   - (e) 전체 감성 점수 = 모든 토큰 감성 점수의 합
   - (f) 감성 점수 > 0 → **긍정(1)**, ≤ 0 → **부정(0)**

#### Part B: ML 기반 감성 분석

3. **데이터 분할**: train(70%) / test(30%), `random_state=42`

4. **불균형 처리**: train 데이터에 대해 소수 클래스(부정) **오버샘플링** 수행
   - 방법: `np.random.choice` + `replace=True`로 부정 샘플을 긍정 수와 동일하게 복제
   - `random_state=42`

5. **TF-IDF 벡터화**: `sklearn`의 `TfidfVectorizer` 사용 허용
   - `sublinear_tf=False`, `smooth_idf=True`

6. **모델 학습**: `LogisticRegression(C=1.0, penalty='l2', random_state=42, max_iter=1000)`

7. **⚠ 데이터 누수 방지**: TF-IDF의 `fit`은 **train 데이터에서만** 수행, test 데이터에는 `transform`만 적용

#### Part C: 비교 분석 및 SHAP 해석

8. **두 접근법의 test 데이터 성능**을 다음 지표로 비교:
   - Accuracy, Precision (긍정/부정 각각), Recall (긍정/부정 각각), F1-score (Macro 평균)

9. **SHAP 해석:**
   - `shap.LinearExplainer`를 사용하여 ML 모델의 SHAP 값 계산
   - **긍정 예측에 가장 기여한 상위 5개 단어**와 SHAP 값
   - **부정 예측에 가장 기여한 상위 5개 단어**와 SHAP 값

10. **비즈니스 요약:** 분석 결과를 영업팀/마케팅팀이 이해할 수 있는 **3문장 이내**의 비기술적 언어로 요약

---

### [ 제약 사항 ]
- 규칙 기반 파트는 `sklearn` 사용 금지 (NumPy + 감성 사전만)
- ML 파트에서 `TfidfVectorizer`의 **fit은 train 데이터에서만** 수행
- 오버샘플링은 **train 데이터에만** 적용 (test 데이터는 원본 유지)
- `shap` 라이브러리 사용 필수 (`pip install shap`)
- 모든 수치는 **소수점 이하 4자리**로 반올림

---

### [ 입력 형식 ]

| 파일 | 설명 |
|------|------|
| `reviews.csv` | `text` 열(리뷰 텍스트)과 `label` 열(0 또는 1), 총 1,000건 |
| `sentiment_dict.json` | 감성 사전 (positive, negative, negation, intensifier) |

---

### [ 출력 형식 ]

`result_q4.json` 파일로 다음 구조를 저장하세요:

```json
{
  "rule_based": {
    "accuracy": 실수, "precision_pos": 실수, "recall_pos": 실수,
    "precision_neg": 실수, "recall_neg": 실수, "f1_macro": 실수
  },
  "ml_based": {
    "accuracy": 실수, "precision_pos": 실수, "recall_pos": 실수,
    "precision_neg": 실수, "recall_neg": 실수, "f1_macro": 실수
  },
  "shap_top5_positive": [{"word": "문자열", "shap_value": 실수}, ...],
  "shap_top5_negative": [{"word": "문자열", "shap_value": 실수}, ...],
  "business_summary": "3문장 이내 비기술적 요약"
}
```

---

### [ 제출 방식 ]

아래 **두 파일**을 `submissions/` 폴더에 제출하세요.

| 파일 | 파일명 형식 | 예시 |
|------|------------|------|
| 솔루션 코드 | `solution_{단계}_q4_{학번}.py` | `solution_advanced_q4_20210001.py` |
| 결과 JSON | `result_{단계}_q4_{학번}.json` | `result_advanced_q4_20210001.json` |

- **단계**: `advanced` (심화) / `basic` (기초) / `intro` (입학연수)
- **학번**: 본인 학번
- 두 파일 모두 제출해야 채점이 진행됩니다.
